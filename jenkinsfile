pipeline {
   agent any
   
   environment {
       docker_host = "hexinlai"
       img_name = "hello-world"
       docker_img_name = "${docker_host}/${img_name}"
       dockerUser = "hexinlai"
   }

   stages {
      stage('Package') {
         steps {
            // Get some code from a GitHub repository
            git 'https://github.com/hexinlai/spring-boot-helloworld.git'

            // Run Maven on a Unix agent.
            sh "mvn clean package"

         }
      }
      stage('Build') {
         steps {
	          sh "docker build -t ${docker_img_name}:${build_tag} ./"
         }
      }

      stage('Push') {
         steps {
	          sh "docker login -u ${dockerUser} -p ${dockerPassword}"
	          sh "docker push ${docker_img_name}:${build_tag}"
         }
      }
   }
}
